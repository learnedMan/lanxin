(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08d2c888"],{4181:function(e,t,a){"use strict";a("5e3d")},"5e3d":function(e,t,a){},"873b":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mbhmealmange"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0}},[a("el-form-item",{attrs:{label:"所属产品："}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changesource_id},model:{value:e.queryParams.sourceId,callback:function(t){e.$set(e.queryParams,"sourceId",t)},expression:"queryParams.sourceId"}},e._l(e.productList,(function(e){return a("el-option",{key:e.source_id,attrs:{label:e.name,value:e.source_id||0}})})),1)],1),a("el-form-item",{attrs:{label:"套餐名："}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入关键字",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.mealName,callback:function(t){e.$set(e.queryParams,"mealName",t)},expression:"queryParams.mealName"}})],1),a("el-form-item",{attrs:{label:"终端："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.queryParams.appType,callback:function(t){e.$set(e.queryParams,"appType",t)},expression:"queryParams.appType"}},e._l(e.appTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"更新时间："}},[a("el-date-picker",{attrs:{type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:e.changedate},model:{value:e.datevalue,callback:function(t){e.datevalue=t},expression:"datevalue"}})],1),a("el-form-item",[a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.initcondition}},[e._v("重置")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.adddata}},[e._v("新增")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},border:"",data:e.dataList}},[a("el-table-column",{attrs:{label:"ID",align:"center",prop:"id"}}),a("el-table-column",{attrs:{align:"center",label:"JSON",prop:"path",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[t.row.publishJson?a("el-popover",{attrs:{placement:"right-start",trigger:"hover"}},[a("div",{staticClass:"popover-box"},[a("pre",[e._v(e._s(e.fmtBody(t.row.publishJson)))])]),a("i",{staticClass:"el-icon-view",attrs:{slot:"reference"},slot:"reference"})]):a("span",[e._v("无")])],1)]}}])}),a("el-table-column",{attrs:{label:"套餐ID",align:"center",prop:"mealId"}}),a("el-table-column",{attrs:{label:"套餐名",align:"center",prop:"mealName","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"终端",align:"center",prop:"appType","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"版本",align:"center",prop:"version","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"更新时间",align:"center",prop:"createdAt","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{width:"160px",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("Iconbutton",{attrs:{icontype:"xg",label:"修改"},on:{fatherMethod:function(a){return e.editdata(t.row)}}}),a("Iconbutton",{attrs:{icontype:"sc",label:"删除"},on:{fatherMethod:function(a){return e.handleDelete(t.row)}}})]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.totalCount>0,expression:"totalCount>0"}],attrs:{total:e.totalCount,page:e.queryParams.pageIndex,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageIndex",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{width:"550px","close-on-click-modal":!1,title:e.dialogTitle,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{"label-width":"120px",label:"套餐:",prop:"mealId"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.mealId,callback:function(t){e.$set(e.form,"mealId",t)},expression:"form.mealId"}},e._l(e.mealList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.mealName,value:e.id}})})),1)],1),a("el-form-item",{attrs:{"label-width":"120px",label:"终端:",prop:"appType"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.appTypechange},model:{value:e.form.appType,callback:function(t){e.$set(e.form,"appType",t)},expression:"form.appType"}},e._l(e.f_appTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{"label-width":"120px",label:"版本:",prop:"version"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}},e._l(e.versionList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.platform+"："+e.version_code,value:e.version_code}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],on:{click:e.closeDialog}},[e._v("取 消")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary"},on:{click:e.enterDialog}},[e._v("确 定")])],1)],1)],1)},r=[],s=(a("4de4"),a("d3b7"),a("e9c4"),a("0fea")),o={name:"mbhmealmange",data:function(){return{datevalue:"",product_id:"",queryParams:{pageIndex:1,pageSize:10,sourceId:0,mealName:"",appType:""},loading:!0,dataList:[],totalCount:0,dialogFormVisible:!1,form:{},rules:{appType:[{required:!0,message:"请选择终端",trigger:"blur"}],version:[{required:!0,message:"请选择版本",trigger:"blur"}]},dialogType:"add",dialogTitle:"",mealList:[],productList:[],versionList:[],_versionList:[],appTypeList:[{value:"",label:"全部"},{value:"ANDROID",label:"ANDROID"},{value:"IOS",label:"IOS"},{value:"WEB",label:"WEB"}]}},created:function(){this.getproductList()},computed:{f_appTypeList:function(){return this.appTypeList.filter((function(e){return""!=e.value}))}},methods:{fmtBody:function(e){try{return JSON.parse(e)}catch(t){return e}},appTypechange:function(){var e=this;this.form.version="",this.versionList=JSON.parse(JSON.stringify(this._versionList)),this.versionList=this.versionList.filter((function(t){return t.platform.toLowerCase()==e.form.appType.toLowerCase()}))},getmealList:function(){var e=this,t={sourceId:this.queryParams.sourceId};Object(s["wc"])(t).then((function(t){e.mealList=t.data}))},getproductList:function(){var e=this;Object(s["jc"])({}).then((function(t){e.productList=t.data.filter((function(e){return"app"==e.type})),e.product_id=e.productList[0].id,e.queryParams.sourceId=e.productList[0].source_id,e.getversionsList(),e.getmealList(),e.initForm(),e.getList()}))},getversionsList:function(){var e=this,t={page:1,pageSize:999,product_id:this.product_id};Object(s["kc"])(t).then((function(t){e._versionList=JSON.parse(JSON.stringify(t.data)),e.versionList=t.data}))},changesource_id:function(e){for(var t=0;t<this.productList.length;t++)this.productList[t].source_id==e&&(this.product_id=this.productList[t].id);this.getmealList(),this.getversionsList(),this.handleQuery(),this.initForm()},initcondition:function(){this.queryParams.mealName="",this.queryParams.appType="",this.queryParams.beginTime="",this.queryParams.endTime="",this.datevalue=""},changedate:function(){try{this.queryParams.beginTime=this.datevalue[0],this.queryParams.endTime=this.datevalue[1]}catch(e){this.queryParams.beginTime="",this.queryParams.endTime=""}},handleQuery:function(){this.loading=!0,this.queryParams.pageIndex=1,this.getList()},getList:function(){var e=this;this.loading=!0,Object(s["Nb"])(this.queryParams).then((function(t){e.loading=!1,e.dataList=t.data.list,e.totalCount=t.data.totalCount}))},adddata:function(){this.initForm(),this.dialogTitle="新增发布",this.dialogType="add",this.dialogFormVisible=!0},initForm:function(){this.form={mealId:"",sourceId:this.queryParams.sourceId,version:"",appType:""},this.$refs.dataForm&&this.$refs.dataForm.resetFields()},editdata:function(e){var t=this;this.initForm(),this.dialogTitle="编辑发布",this.dialogType="edit",this.$nextTick((function(){t.form=JSON.parse(JSON.stringify(e)),t.versionList=JSON.parse(JSON.stringify(t._versionList)),t.versionList=t.versionList.filter((function(e){return e.platform.toLowerCase()==t.form.appType.toLowerCase()}))})),this.dialogFormVisible=!0},closeDialog:function(){this.initForm(),this.dialogFormVisible=!1},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除套餐ID为"+e.mealId+"的模板化套餐, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["I"])(e.id).then((function(e){t.$message({message:"删除成功",type:"success"}),t.getList()}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},enterDialog:function(){var e=this;this.$refs["dataForm"].validate((function(t){if(t)if("edit"==e.dialogType){for(var a=0;a<e.mealList.length;a++)e.mealList[a].id==e.form.mealId&&(e.form.mealName=e.mealList[a].mealName);Object(s["kb"])(e.form).then((function(t){e.$message({message:"修改成功",type:"success"}),e.dialogFormVisible=!1,e.getList()}))}else Object(s["d"])(e.form).then((function(t){e.$message({message:"新建成功",type:"success"}),e.dialogFormVisible=!1,e.getList()}))}))}}},l=o,n=(a("4181"),a("9b8c"),a("2877")),u=Object(n["a"])(l,i,r,!1,null,"9b03b186",null);t["default"]=u.exports},"9b8c":function(e,t,a){"use strict";a("f111")},f111:function(e,t,a){}}]);