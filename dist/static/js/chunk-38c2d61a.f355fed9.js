(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38c2d61a"],{"133a":function(t,e,a){},"6fd7":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xl-watch-column"},[a("el-form",{ref:"queryForm",attrs:{inline:!0}},[a("el-form-item",[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:t.handleReturn}},[t._v(" 返回上一级 ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:t.tableData,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"新闻ID",align:"center",prop:"id"}}),a("el-table-column",{attrs:{label:"新闻名称",align:"center",prop:"title","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"watch-detail-btn",attrs:{type:"text"},on:{click:function(a){return t.handleWatch(e.row)}}},[t._v(t._s(e.row.title))])]}}])}),a("el-table-column",{attrs:{label:"新闻类型",align:"center",prop:"type"}}),a("el-table-column",{attrs:{label:"栏目ID",align:"center",prop:"channel_id","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"栏目名称",align:"center",prop:"channel_name","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"评论控制",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{size:"small"},on:{change:function(a){return t.changeCommentAndShare(e.row,"allow_comment")}},model:{value:e.row.allow_comment,callback:function(a){t.$set(e.row,"allow_comment",a)},expression:"scope.row.allow_comment"}},t._l(t.commentOption,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)]}}])}),a("el-table-column",{attrs:{label:"分享控制",align:"center","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{size:"small"},on:{change:function(a){return t.changeCommentAndShare(e.row,"allow_share")}},model:{value:e.row.allow_share,callback:function(a){t.$set(e.row,"allow_share",a)},expression:"scope.row.allow_share"}},t._l(t.shareOption,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)]}}])}),a("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{size:"small"},on:{change:function(a){return t.changeStatus(e.row)}},model:{value:e.row.status,callback:function(a){t.$set(e.row,"status",a)},expression:"scope.row.status"}},t._l(t.statusOptions.filter((function(t){return""!==t.value})),(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"380"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"verify-table-action"},[a("Iconbutton",{attrs:{icontype:"shjd",label:"审核进度"},on:{fatherMethod:function(a){return t.watchProgress(e.row)}}}),a("Iconbutton",{attrs:{icontype:"sc",label:"删除"},on:{fatherMethod:function(a){return t.handleListDelete(e.row)}}}),1===e.row.status?a("Iconbutton",{attrs:{icontype:"ckxq",label:"查看详情"},on:{fatherMethod:function(a){return t.handleWatch(e.row)}}}):t._e(),1!==e.row.status?a("Iconbutton",{attrs:{icontype:"xg",label:"编辑"},on:{fatherMethod:function(a){return t.handleEdit(e.row)}}}):t._e(),a("Iconbutton",{attrs:{icontype:"czjl",label:"操作记录"},on:{fatherMethod:function(a){return t.handleHistory(e.row)}}})],1)]}}])})],1),a("el-dialog",{attrs:{width:"400px",title:"审批进度",visible:t.approval.show},on:{"update:visible":function(e){return t.$set(t.approval,"show",e)}}},[a("el-steps",{attrs:{direction:"vertical",active:t.approval.active,space:100}},t._l(t.approval.lists,(function(e){return a("el-step",{key:e.sort,attrs:{title:e.title,description:e.description}},[a("div",{attrs:{slot:"description"},slot:"description"},[a("div",[t._v("提交人/审核人: "+t._s(e.name))]),e.remark?a("p",[t._v("拒绝原因: "+t._s(e.remark))]):t._e()])])})),1)],1),t.dialog.show?a("el-dialog",{attrs:{width:"1200px",title:t.dialog.title,top:"20px",visible:t.dialog.show},on:{"update:visible":function(e){return t.$set(t.dialog,"show",e)}}},[a("new-detail",{attrs:{id:t.dialog.id,visible:t.dialog.show,disabled:t.dialog.disabled},on:{"update:visible":function(e){return t.$set(t.dialog,"show",e)},refresh:t.refresh}})],1):t._e(),t.history.show?a("el-dialog",{attrs:{width:"700px",title:"操作记录",visible:t.history.show},on:{"update:visible":function(e){return t.$set(t.history,"show",e)}}},[a("version-history",{attrs:{id:t.history.id,type:"news"}})],1):t._e()],1)},i=[],l=a("ade3"),o=a("5530"),s=(a("d81d"),a("b0c0"),a("d3b7"),a("7db0"),a("c740"),a("ac1f"),a("1276"),a("a15b"),a("4de4"),a("caad"),a("2532"),a("25f0"),a("99af"),a("cc48")),r=a("0fea"),u=a("1d6e"),c=a("9d3e"),d={components:{newDetail:u["a"],VersionHistory:c["a"]},data:function(){return{statusOptions:[{label:"全部",value:""},{label:"待审核",value:0},{label:"已上线",value:1},{label:"已下线",value:2}],tableData:[],typeOptions:[{label:"全部",value:""},{label:"新闻",value:"news"},{label:"图集",value:"album"},{label:"视频",value:"video"},{label:"外链",value:"outer_link"}],commentOption:[{label:"先审后发",value:"0"},{label:"先发后审",value:"1"},{label:"禁止评论",value:"2"}],shareOption:[{label:"允许",value:"1"},{label:"不允许",value:"2"}],loading:!1,approval:{show:!1,active:"",lists:[]},dialog:{title:"查看详情",show:!1,id:"",disabled:!1},history:{show:!1,id:""},userLists:[]}},computed:{visitedViews:function(){return this.$store.state.tagsView.visitedViews}},created:function(){this.getList(),this.getUserList()},methods:{getUserList:function(){var t=this;Object(r["wb"])({model:"User",page:1,pageSize:9999}).then((function(e){var a=e.data;t.userLists=a.map((function(t){var e=t.id,a=t.name;return{id:e,name:a}}))}))},getList:function(){var t=this,e=this.$route.query.id;this.loading=!0,Object(s["s"])(e).then((function(e){t.tableData=(e.news||[]).map((function(a){var n,i=t.typeOptions.find((function(t){return a.type===t.value})),l=t.statusOptions.find((function(t){return a.status===t.value}));return Object(o["a"])(Object(o["a"])({},a),{},{channel_name:(null===(n=(e.channel||[]).find((function(t){return t.id===a.channel_id})))||void 0===n?void 0:n.name)||"",type:i&&i.label||"",statusLabel:l&&l.label||"",allow_comment:a.extra.allow_comment,allow_share:a.extra.allow_share})}))})).finally((function(){t.loading=!1}))},handleReturn:function(){var t=this.$route.fullPath,e=this.visitedViews.find((function(e){return e.fullPath===t})),a=this.$route.query.redirect,n=void 0===a?"All-media":a;this.$router.push({name:n}),this.$store.dispatch("tagsView/delView",e)},handleListDelete:function(t){var e=this,a=t.id;this.$confirm("此操作将永久删除这条新闻, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["j"])(a).then((function(){e.$message({message:"删除成功",type:"success"}),e.getList()}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},changeCommentAndShare:function(t,e){var a=this,n=t.id;Object(s["d"])(n,{extra:Object(l["a"])({},e,t[e])}).then((function(t){var e=t.message,n=t.statu_code;n?a.$message({message:e,type:"error"}):a.$message({message:"切换成功!",type:"success"}),a.getList()}))},watchProgress:function(t){var e=this,a=t.extra.multi_review||[];if(0===a.length)return this.$message.warning("暂无审批进度");var n=[{label:"待审核",value:0},{label:"已审核",value:1},{label:"已拒绝",value:2}];this.approval={show:!0,active:a.findIndex((function(t){return 1===t.status||2===t.status}))+1,lists:a.map((function(t){var a,i=t.reviewer_ids.split(",");return Object(o["a"])(Object(o["a"])({},t),{},{name:e.userLists.filter((function(e){return t.user_id?e.id===t.user_id:i.includes(e.id.toString())})).map((function(t){return t.name})).join(),title:"".concat(null===(a=n.find((function(e){return t.status===e.value})))||void 0===a?void 0:a.label,"   ").concat(t.time||"")})}))}},handleWatch:function(t){var e=t.id;this.dialog={title:"查看详情",show:!0,id:e,disabled:!0}},handleEdit:function(t){var e=t.id;this.dialog={title:"编辑详情",show:!0,id:e,disabled:!1}},changeStatus:function(t){var e=this,a=t.id,n=t.status;Object(s["f"])({ids:a,status:n}).then((function(){e.$message({message:"修改成功",type:"success"}),e.getList()}))},refresh:function(){this.getList()},handleHistory:function(t){var e=t.id;this.history={show:!0,id:e}}}},h=d,p=a("2877"),f=Object(p["a"])(h,n,i,!1,null,"37b5bbfc",null);e["default"]=f.exports},"734e":function(t,e,a){"use strict";a("133a")},"9d3e":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xl-version-history"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:t.tableData,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"created_at",label:"日期",align:"center"}}),a("el-table-column",{attrs:{prop:"user.name",label:"姓名","show-overflow-tooltip":"",align:"center"}}),a("el-table-column",{attrs:{prop:"operation",label:"操作记录","show-overflow-tooltip":"",align:"center"}}),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.handleWatch(e.row)}}},[t._v(" 查看详情 ")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{total:t.total,page:t.queryParams.page,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"page",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getHistory}}),t.dialog.show?a("el-dialog",{attrs:{width:"1200px",top:"20px",title:t.dialog.title,visible:t.dialog.show,"append-to-body":""},on:{"update:visible":function(e){return t.$set(t.dialog,"show",e)}}},["news"===t.type?a("new-detail",{attrs:{id:t.id,visible:t.dialog.show,"fetch-suggestions":t.fetchSuggestions,disabled:!0},on:{"update:visible":function(e){return t.$set(t.dialog,"show",e)}}}):t._e(),"script"===t.type?a("scripts-details",{staticStyle:{padding:"10px",margin:"0"},attrs:{id:t.id,visible:t.dialog.show,"fetch-suggestions":t.fetchSuggestions,disabled:!0},on:{"update:visible":function(e){return t.$set(t.dialog,"show",e)}}}):t._e()],1):t._e()],1)},i=[],l=a("5530"),o=(a("a9e3"),a("d3b7"),a("cc48")),s=a("1d6e"),r=a("5fe8"),u={name:"versionHistory",components:{NewDetail:s["a"],scriptsDetails:r["default"]},props:{type:{type:String,default:"script"},id:{type:Number,required:!0}},data:function(){return{tableData:[],total:0,loading:!1,queryParams:{page:1,pageSize:10},dialog:{title:"查看详情",show:!1,id:""},fetchSuggestions:function(){return new Promise((function(t){return t()}))}}},methods:{getHistory:function(){var t=this,e=this.id,a=this.type;this.loading=!0,Object(o["o"])(Object(l["a"])({item_type:a,item_id:e},this.queryParams)).then((function(e){var a=e.data,n=e.total;t.tableData=a,t.total=n})).finally((function(){t.loading=!1}))},handleWatch:function(t){var e=t.extra;this.fetchSuggestions=function(){return new Promise((function(t){t(e.item)}))},this.dialog={title:"查看详情",show:!0}}},created:function(){this.getHistory()}},c=u,d=(a("734e"),a("2877")),h=Object(d["a"])(c,n,i,!1,null,"cb2618ba",null);e["a"]=h.exports}}]);