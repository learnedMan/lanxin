(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3daddf8d"],{"0166":function(e,t,a){},"0b56":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"myResources"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0}},[a("el-form-item",{attrs:{label:"图片名称："}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入关键字",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.keyword,callback:function(t){e.$set(e.queryParams,"keyword",t)},expression:"queryParams.keyword"}})],1),a("el-form-item",[a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.initcondition}},[e._v("重置")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.adddata}},[e._v("新增")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},border:"",data:e.dataList}},[a("el-table-column",{attrs:{label:"ID",align:"center",prop:"id"}}),a("el-table-column",{attrs:{label:"图片",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{title:"",placement:"right","popper-class":"imgpopover",trigger:"hover"}},[a("img",{attrs:{src:t.row.url||e.noimg}}),a("img",{staticStyle:{"max-height":"50px","max-width":"50px"},attrs:{slot:"reference",src:t.row.url||e.noimg,alt:t.row.url||e.noimg},slot:"reference"})])]}}])}),a("el-table-column",{attrs:{label:"图片名称",align:"center",prop:"title","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"分类",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("formatcategory")(t.row.category)))])]}}])}),a("el-table-column",{attrs:{label:"作者",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.author?t.row.author.name:"无"))])]}}])}),a("el-table-column",{attrs:{label:"大小",align:"center",prop:"size","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"拍摄时间",align:"center",prop:"time","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"上传时间",align:"center",prop:"created_at","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{width:"220px",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("Iconbutton",{attrs:{icontype:"xiazai",label:"下载"},on:{fatherMethod:function(a){return e.download(t.row)}}}),a("Iconbutton",{attrs:{icontype:"xg",label:"修改"},on:{fatherMethod:function(a){return e.editdata(t.row)}}}),a("Iconbutton",{attrs:{icontype:"sc",label:"删除"},on:{fatherMethod:function(a){return e.handleDelete(t.row)}}})]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.page,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"page",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}),a("el-dialog",{attrs:{width:"600px","close-on-click-modal":!1,title:e.dialogTitle,top:"10vh",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{"label-width":"100px",label:"图片:",prop:"url"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.VUE_APP_BASE_API+"/api/upload/image",headers:e.importHeaders,name:"image","show-file-list":!1,"http-request":e.uploadFile,"on-success":e.handleAvatarSuccess.bind(this,"url"),"before-upload":e.beforeAvatarUpload}},[e.form.url?a("img",{staticClass:"avatar",attrs:{src:e.form.url}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("el-form-item",{attrs:{"label-width":"100px",label:"图片名称",prop:"title"}},[a("el-input",{staticStyle:{width:"350px"},attrs:{autocomplete:"off",placeholder:"请输入图片名称"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),a("el-form-item",{attrs:{"el-form-item":"","label-width":"100px",label:"分类:",prop:"_category"}},[a("el-select",{attrs:{multiple:"",placeholder:"请选择"},on:{change:function(t){return e.$forceUpdate()}},model:{value:e.form._category,callback:function(t){e.$set(e.form,"_category",t)},expression:"form._category"}},e._l(e.classoptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{"label-width":"100px",label:"拍摄时间",prop:"time"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm:ss",align:"right"},model:{value:e.form.time,callback:function(t){e.$set(e.form,"time",t)},expression:"form.time"}})],1),a("el-form-item",{attrs:{"label-width":"100px",label:"描述",prop:"description"}},[a("el-input",{staticStyle:{width:"350px"},attrs:{type:"textarea",autocomplete:"off",placeholder:"请输入描述",autosize:{minRows:4}},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],on:{click:e.closeDialog}},[e._v("取 消")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary"},on:{click:e.enterDialog}},[e._v("确 定")])],1)],1)],1)},i=[],r=a("53ca"),n=(a("b0c0"),a("a15b"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("e9c4"),a("99af"),a("b64b"),a("0fea")),l={name:"myResources",data:function(){var e=sessionStorage.getItem("token");return{importHeaders:{Authorization:e},noimg:a("403c"),queryParams:{page:1,pageSize:10,keyword:""},loading:!0,dataList:[],total:0,dialogFormVisible:!1,form:{},rules:{url:[{required:!0,message:"请选择图片",trigger:"blur"}],title:[{required:!0,message:"请输入图片名称",trigger:"blur"}],_category:[{required:!0,message:"请选择分类",trigger:"blur"}]},dialogType:"add",dialogTitle:"",classoptions:[]}},filters:{formatcategory:function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].name);return t.join()}},computed:{VUE_APP_BASE_API:function(){return this.imgurl2}},created:function(){this.getList(),this.getclassList(),this.initForm()},methods:{download:function(e){var t=document.createElement("a");t.target="_blank",t.href=this.VUE_APP_BASE_API+"/api/resources/downloadResource?file_url="+e.url,t.download=e.title,t.click()},handleAvatarSuccess:function(e,t){this.form[e]=t.path,this.$forceUpdate()},beforeAvatarUpload:function(e){var t=e.size/1024/1024<20;return t||this.$message.error("上传头像图片大小不能超过 20MB!"),t},uploadFile:function(e){this.form.url=URL.createObjectURL(e.file),this.form.file=e.file},initcondition:function(){this.queryParams.keyword=""},handleQuery:function(){this.loading=!0,this.queryParams.page=1,this.getList()},getclassList:function(){var e=this,t={page:1,pageSize:999};Object(n["hc"])(t).then((function(t){e.classoptions=t.data}))},getList:function(){var e=this;Object(n["ic"])(this.queryParams).then((function(t){e.loading=!1,e.dataList=t.data,e.total=t.total}))},adddata:function(){this.initForm(),this.dialogTitle="新增图片",this.dialogType="add",this.dialogFormVisible=!0},initForm:function(){this.form={url:"",file:"",type:"image",title:"",_category:[],category:[],author:"",time:"",description:""},this.$refs.dataForm&&this.$refs.dataForm.resetFields()},editdata:function(e){var t=this;this.initForm(),this.dialogTitle="编辑图片",this.dialogType="edit",this.$nextTick((function(){t.form=JSON.parse(JSON.stringify(e));for(var a=[],o=0;o<t.form.category.length;o++)a.push(t.form.category[o].id);t.form._category=a,t.$forceUpdate()})),this.dialogFormVisible=!0},closeDialog:function(){this.initForm(),this.dialogFormVisible=!1},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除id为"+e.id+"的图片, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(n["db"])(e.id,e).then((function(e){t.$message({message:"删除成功",type:"success"}),t.getList()}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},toFormData:function(e){var t=new FormData;for(var a in e)o(e[a],a);function o(e,a){if(void 0==e||"function"==typeof e)return!1;if("object"!=Object(r["a"])(e))t.append(a,e);else if(e instanceof Array)if(0==e.length)t.append("".concat(a),"");else for(var i in e)for(var n in e[i])o(e[i][n],"".concat(a,"[").concat(i,"].").concat(n));else{var l=Object.keys(e);if(-1==l.indexOf("uid"))for(var s in e)o(e[s],"".concat(a,".").concat(s));else t.append("".concat(a),e)}}return t},enterDialog:function(){var e=this,t=this.form;t.category=t._category.join(),t=this.toFormData(t),this.$refs["dataForm"].validate((function(a){a&&("edit"==e.dialogType?Object(n["vb"])(e.form.id,t).then((function(t){e.$message({message:"修改成功",type:"success"}),e.dialogFormVisible=!1,e.getList()})):Object(n["r"])(t).then((function(t){e.$message({message:"新建成功",type:"success"}),e.dialogFormVisible=!1,e.getList()})))}))}}},s=l,c=(a("96c4"),a("377c"),a("2877")),u=Object(c["a"])(s,o,i,!1,null,"d75e832e",null);t["default"]=u.exports},"377c":function(e,t,a){"use strict";a("0166")},"96c4":function(e,t,a){"use strict";a("ecd7")},e9c4:function(e,t,a){var o=a("23e7"),i=a("d066"),r=a("d039"),n=i("JSON","stringify"),l=/[\uD800-\uDFFF]/g,s=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,u=function(e,t,a){var o=a.charAt(t-1),i=a.charAt(t+1);return s.test(e)&&!c.test(i)||c.test(e)&&!s.test(o)?"\\u"+e.charCodeAt(0).toString(16):e},d=r((function(){return'"\\udf06\\ud834"'!==n("\udf06\ud834")||'"\\udead"'!==n("\udead")}));n&&o({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,a){var o=n.apply(null,arguments);return"string"==typeof o?o.replace(l,u):o}})},ecd7:function(e,t,a){}}]);