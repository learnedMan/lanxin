(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ccee641"],{"293f":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"xl-convention"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,size:"small"}},[a("el-form-item",{attrs:{label:"所属产品:"}},[a("el-select",{attrs:{placeholder:"请选择所属产品"},on:{change:e.handleQuery},model:{value:e.queryParams.sourceId,callback:function(t){e.$set(e.queryParams,"sourceId",t)},expression:"queryParams.sourceId"}},e._l(e.productLists,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"规则名称:",prop:"ruleName"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入规则名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.ruleName,callback:function(t){e.$set(e.queryParams,"ruleName",t)},expression:"queryParams.ruleName"}})],1),a("el-form-item",{attrs:{label:"状态:",prop:"status"}},[a("el-select",{attrs:{placeholder:"请选择状态"},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.statusLists,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",[a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.handleAdd}},[e._v(" 新增 ")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.handleReset}},[e._v(" 重置 ")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary",size:"mini"},on:{click:e.handleQuery}},[e._v(" 搜索 ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:e.tableData,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:"规则名称",align:"center",prop:"ruleName"}}),a("el-table-column",{attrs:{label:"类型",align:"center",prop:"typeLabel",showOverflowTooltip:""}}),a("el-table-column",{attrs:{label:"行为",align:"center",prop:"actionLabel",showOverflowTooltip:""}}),a("el-table-column",{attrs:{label:"积分",align:"center",prop:"points"}}),a("el-table-column",{attrs:{label:"每日最高限额",align:"center",prop:"upperLineEverydayLabel"}}),a("el-table-column",{attrs:{label:"最高限额积分",align:"center",prop:"upperLineLabel"}}),a("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{on:{change:function(a){return e.handleChangeStatus(t.row)}},model:{value:t.row.status,callback:function(a){e.$set(t.row,"status",a)},expression:"scope.row.status"}},e._l(e.statusLists,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("Iconbutton",{attrs:{icontype:"xg",label:"修改"},on:{fatherMethod:function(a){return e.handleEdit(t.row)}}}),a("Iconbutton",{attrs:{icontype:"sc",label:"删除"},on:{fatherMethod:function(a){return e.handleDelete(t.row)}}})]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.page,limit:e.queryParams.limit},on:{"update:page":function(t){return e.$set(e.queryParams,"page",t)},"update:limit":function(t){return e.$set(e.queryParams,"limit",t)},pagination:e.getList}}),a("el-dialog",{attrs:{width:"600px",title:e.dialog.title,visible:e.dialog.show},on:{"update:visible":function(t){return e.$set(e.dialog,"show",t)}}},[a("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.dialogRules,size:"small","label-width":"120px"}},[a("el-form-item",{attrs:{label:"积分规则名称",prop:"ruleName"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{clearable:""},model:{value:e.dialogForm.ruleName,callback:function(t){e.$set(e.dialogForm,"ruleName",t)},expression:"dialogForm.ruleName"}})],1),a("el-form-item",{attrs:{label:"规则说明",prop:"ruleRemark"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入积分规则说明",type:"textarea",rows:6},model:{value:e.dialogForm.ruleRemark,callback:function(t){e.$set(e.dialogForm,"ruleRemark",t)},expression:"dialogForm.ruleRemark"}})],1),a("el-form-item",{attrs:{label:"规则类型",prop:"type"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择规则类型",clearable:""},on:{change:function(t){e.dialogForm.action=""}},model:{value:e.dialogForm.type,callback:function(t){e.$set(e.dialogForm,"type",t)},expression:"dialogForm.type"}},e._l(e.typeLists,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"行为",prop:"action"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择行为",clearable:""},model:{value:e.dialogForm.action,callback:function(t){e.$set(e.dialogForm,"action",t)},expression:"dialogForm.action"}},e._l(e.actionOfType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"赠送积分",prop:"points"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入赠送积分值"},model:{value:e.dialogForm.points,callback:function(t){e.$set(e.dialogForm,"points",e._n(t))},expression:"dialogForm.points"}})],1),a("el-form-item",{attrs:{label:"每日最高限额",prop:"upperLineEveryday"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入积分值(0表示不限)"},model:{value:e.dialogForm.upperLineEveryday,callback:function(t){e.$set(e.dialogForm,"upperLineEveryday",e._n(t))},expression:"dialogForm.upperLineEveryday"}})],1),a("el-form-item",{attrs:{label:"最高限额",prop:"upperLine"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"请输入积分值(0表示不限)"},model:{value:e.dialogForm.upperLine,callback:function(t){e.$set(e.dialogForm,"upperLine",e._n(t))},expression:"dialogForm.upperLine"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.dialogForm.status,callback:function(t){e.$set(e.dialogForm,"status",t)},expression:"dialogForm.status"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],on:{click:function(t){e.dialog.show=!1}}},[e._v(" 取 消 ")]),a("el-button",{directives:[{name:"points",rawName:"v-points",value:1500,expression:"1500"}],attrs:{type:"primary"},on:{click:e.enterDialog}},[e._v(" 确 定 ")])],1)],1)],1)},l=[],i=a("1da1"),o=a("5530"),n=(a("96cf"),a("8ba4"),a("a9e3"),a("4de4"),a("d3b7"),a("d81d"),a("b0c0"),a("7db0"),a("0fea")),s={name:"Convention",data:function(){var e=function(e,t,a){if(console.log(t),null==t||""===t)return a(new Error("每日最高限额不能为空"));!Number.isInteger(t)||t<0?a(new Error("请输入正整数")):a()},t=function(e,t,a){if(null==t||""===t)return a(new Error("最高限额不能为空"));!Number.isInteger(t)||t<0?a(new Error("请输入正整数")):a()},a=function(e,t,a){if(null==t||""===t)return a(new Error("赠送积分值不能为空"));!Number.isInteger(t)||t<0?a(new Error("请输入正整数")):a()};return{productLists:[],statusLists:[{label:"启用",value:1},{label:"不启用",value:0}],typeLists:[],actionLists:[],queryParams:{sourceId:"",ruleName:"",status:1,page:1,limit:10},total:0,loading:!1,tableData:[],dialog:{title:"新增",show:!1},dialogForm:{ruleName:"",ruleRemark:"",type:"",points:"",action:"",upperLineEveryday:"",upperLine:"",status:1},dialogRules:{ruleName:[{required:!0,message:"请输入规则名称",trigger:"blur"}],type:[{required:!0,message:"请选择规则类型",trigger:"change"}],action:[{required:!0,message:"请选择行为",trigger:"change"}],upperLineEveryday:[{required:!0,validator:e,trigger:"blur"}],upperLine:[{required:!0,validator:t,trigger:"blur"}],points:[{required:!0,validator:a,trigger:"blur"}]}}},computed:{actionOfType:function(){var e=this;return this.actionLists.filter((function(t){return t.parent===e.dialogForm.type}))}},methods:{getProductList:function(){var e=this;return Object(n["nc"])({}).then((function(t){var a,r=t.data||[];e.productLists=r.map((function(e){return{label:e.name,value:e.source_id}})),e.queryParams.sourceId=null===r||void 0===r||null===(a=r[0])||void 0===a?void 0:a.source_id}))},getTypeList:function(){var e=this;return Object(n["cc"])().then((function(t){200==t.code&&(e.typeLists=(t.data||[]).map((function(e){return{label:e.remark,value:Number(e.dictValue)}})))}))},getActionList:function(){var e=this;return Object(n["Db"])().then((function(t){200==t.code&&(e.actionLists=(t.data||[]).map((function(e){return{label:e.remarkTwo,value:Number(e.dictValue),parent:Number(e.remark)}})))}))},handleReset:function(){Object.assign(this.queryParams,{page:1}),this.resetForm("queryForm")},handleQuery:function(){this.queryParams.page=1,this.getList()},handleAdd:function(){this.resetForm("dialogForm"),this.dialog={show:!0,title:"新增"}},handleEdit:function(e){var t=e.id;this.resetForm("dialogForm"),this.dialogForm={ruleName:e.ruleName,ruleRemark:e.ruleRemark,points:e.points,type:e.type,action:e.action,upperLineEveryday:e.upperLineEveryday,upperLine:e.upperLine,status:e.status},this.dialog={show:!0,title:"编辑",id:t}},enterDialog:function(){var e=this;this.$refs.dialogForm.validate((function(t){if(t){var a=e.$store.state.user.u_info,r=Object(o["a"])(Object(o["a"])({},e.dialogForm),{},{operateUserId:a.id,operateUserName:a.name,sourceId:e.queryParams.sourceId}),l=e.dialog.id?Object(n["ob"])(Object(o["a"])(Object(o["a"])({},r),{},{id:e.dialog.id})):Object(n["f"])(r);l.then((function(t){200==t.code&&(e.$message.success(t.msg),e.dialog.show=!1,e.getList())}))}}))},handleDelete:function(e){var t=this,a=e.id,r=this.$store.state.user.u_info;Object(n["U"])({id:a,operateUserId:r.id,operateUserName:r.name}).then((function(e){200==e.code&&(t.$message.success(e.msg),t.getList())}))},handleChangeStatus:function(e){var t=this,a=e.sourceId,r=e.id,l=e.status,i=e.ruleName,o=e.ruleRemark,s=e.type,u=e.action,c=e.upperLineEveryday,p=e.upperLine,d=e.points,m=this.$store.state.user.u_info,b={sourceId:a,id:r,operateUserId:m.id,operateUserName:m.name,ruleName:i,ruleRemark:o,type:s,points:d,action:u,upperLineEveryday:c,upperLine:p,status:l};Object(n["ob"])(b).then((function(e){200==e.code&&(t.$message.success(e.msg),t.getList())}))},getList:function(){var e=this,t=Object(o["a"])({},this.queryParams);this.loading=!0,Object(n["Ub"])(this.removePropertyOfNullFor0(t)).then((function(t){if(200==t.code){var a=t.data;e.tableData=(a.list||[]).map((function(t){var a,r;return Object(o["a"])(Object(o["a"])({},t),{},{typeLabel:null===(a=e.typeLists.find((function(e){return e.value===t.type})))||void 0===a?void 0:a.label,actionLabel:null===(r=e.actionLists.find((function(e){return e.value===t.action})))||void 0===r?void 0:r.label,upperLineEverydayLabel:t.upperLineEveryday||"不限制",upperLineLabel:t.upperLine||"不限制"})})),e.total=a.totalCount}})).finally((function(){e.loading=!1}))}},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getProductList();case 2:return t.next=4,e.getTypeList();case 4:return t.next=6,e.getActionList();case 6:e.getList();case 7:case"end":return t.stop()}}),t)})))()}},u=s,c=(a("95b5"),a("2877")),p=Object(c["a"])(u,r,l,!1,null,"39d93a80",null);t["default"]=p.exports},"40c4":function(e,t,a){},"5e89":function(e,t,a){var r=a("861d"),l=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&l(e)===e}},"8ba4":function(e,t,a){var r=a("23e7"),l=a("5e89");r({target:"Number",stat:!0},{isInteger:l})},"95b5":function(e,t,a){"use strict";a("40c4")}}]);